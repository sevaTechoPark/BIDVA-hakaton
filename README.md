# Описание проекта

В рамках задачи семантического поиска слова/словосочетания в тексте, было разработано решение основанное на клиент-серверной архитектуре.

User-interface (клиентская часть), представлена в виде web-страницы, разработанной на React Framework с применением языка программирования typescript. Для доступа к web-странице из адресной строки браузера используется локальный web-сервер Vite. Данное решение упаковано в Docker container. Исходный код с файлом Dockerfile распологается по пути app/web. При сборке образа и запуске контейнера, открыть web-страницу можно по адресу http://localhost:5173/

Backend (серверная часть) представляет из себя python-проект, работающий на web-сервере uvcorn. За обработку http-запросов отвечание FastAPI. Решение также упаковано в Docker container. Исходный код с файлом Dockerfile располагается по пути app/backend. При сборке образа и запуске контейнера, web-сервер ожидает поступления POST-запроса по адресу http://localhost:5151/search. Тело запроса должно быть передано в формате JSON со следующей структурой: {"document": "",  "word": ""}, где document - документ (текст в котором ищется слово/словосочетание), а word - словосочетание (слово или словосочетание которое ищем). Результатом является JSON-файл со следующей структурой: {"probability": 0.0, "startIndex": 0, "endIndex": 0}, где probability - вероятность нахождения, startIndex и endIndex - начальный и конечный индекы найденного слова. В случае, если слово/словосочетание не найдено в ответе все атрибуты будут инициализированы 0.

За основу модели для семантического поиска взят BERT. Используется дообученная модель deepvk/USER-bge-m3 взятая с сайта https://huggingface.co/. 

Все решение упаковано в docker compose с исходными файлами по пути app/

# Локальный старт приложения

Для локального развёртывания решения. Необходимо загрузить папку app на локальную машину.
Перейти в папку app и в командной строке ввести:
### MacOS

```
docker compose up
```

### linux

```
docker compose up
```
После сборки и запуска контейнеров необходимо перейти по адресу http://localhost:5173/ в адресной строке браузера.
Контейнеры можно считать запущенными при наличии в консоли следующих строк:
- Local:   http://localhost:5173/ (Запущен web-сервер Frontend)
- Uvicorn running on http://127.0.0.1:5151 (Press CTRL+C to quit) (Запущен web-сервер Backend)

Для очистки кэша docker можно использовать команду:
```
docker builder prune -f
```
# Алгоритм семантического поиска
Файл с классом, реализующим функцию семантического поиска, расположен по пути app/backend/app/semantic_search.py
Основной публичный метод search принимает на вход 2 параметра: iDocument - документ (текст по которому будет реализован поиск) и iWord слово или словосочетание для поиска. При вызове данного метода выполняются следующие шаги:
- С помощью метода \_\_prepare_document\_\_ выполняеся обработка документа, а именно:
  - При помощи вспомогательного класса TextPreparetion расположенного по пути app/backend/app/text_preparetion.py, из текста удаляются все знаки препинания, а так же самые часто встречающиеся служебные части речи, такие как 'а', 'в', 'но', 'и', 'не', 'из', 'под';
  - Так как поиск должен быть не только по словам, но и по словосочетаниям, текс делится на парные сегменты, например: из текст «Ранним утром я решил устроить пробежку» получаем набор сегментов [«Ранним утром», «я решил», «решил устроить», «строить пробежку»]);
- Далее в метод \_\_compare_list_embeddings\_\_ передаем список полученных сегментов и текс поиска, а на выходе получаем словарь сегментов с вероятностью совпадения. Описание метода следующее:
  - При помощи метода \_\_get_bert_embedding\_\_ получаем embedding (векторное представление текста) текста для поиска;
  - Далее поочерёдно получаем embedding каждого сегмента и сравниваем косинусное расстояние между embedding'ами;
  - Результат записывается в словарь, где ключ - сегмент, а значение - доля совпадения.
- При помощи метода \_\_get_key_max_similar\_\_ получаем сегмент с наибольшей долей совпадения. Если доля совпадения менее 67% (0.67) - Считаем, что текст поиска в строке не найден. (Число 0.67 подобрано эмпирически);
- Если доля совпадения более 67% (0.67), то на сходство с текстом поиска анализируются отдельные слова из сегмента;
- Среди сегмента и отдельных слов из этого сегмента выбирается результат с наибольшей долей совпадения. 
